var Promise;!function(){var a=Function("return this")(),b=a.setImmediate||a.setTimeout,c=function(){this.onResolve=[],this.onReject=[],this.value=void 0,this.status=0},d=function(a,c,d){return function(e){b(function(){try{c("function"==typeof a?a(e):e)}catch(b){d(b)}})}};Promise=function(a){function g(a){b.status||(b.status=1,a&&a.then&&a["catch"]?a.then(function(a){b.status=0,g(a)},function(a){b.status=0,h(a)}):i(b.onResolve,a))}function h(a){b.status||(b.status=-1,i(b.onReject,a))}function i(a,c){b.value=c,b.status*=2;for(var d=0;d<a.length;d++)a[d](c);delete b.onResolve,delete b.onReject}if("function"!=typeof a)throw new TypeError("Promise resolver is not a function");var b=new c;try{a(g,h)}catch(d){h(d)}var f=this.toString=function(){return f.caller==e?b:"[object Promise]"}};var e=Promise.prototype.then=function(a,b){var c=this.toString();if(!c)throw new Error;return new Promise(function(e,f){var g=d(a,e,f),h=d(b,e,f);switch(c.status){case 2:return g(c.value);case-2:return h(c.value);default:c.onResolve.push(g),c.onReject.push(h)}})};return Promise.prototype["catch"]=function(a){return e.call(this,null,a)},Promise.reject=function(a){return new Promise(function(b,c){c(a)})},Promise.resolve=function(a){return new Promise(function(b){b(a)})},Promise.all=function(a){return new Promise(function(b,c){if(!(a instanceof Array))throw"need an array";var f,d=[],e=a.length;for(0==e&&b(d),f=0;f<a.length;f++)!function(f){Promise.resolve(a[f]).then(function(a){d[f]=a,--e||b(d)},c)}(f)})},Promise.race=function(a){return new Promise(function(b,c){if(!(a instanceof Array))throw"need an array";for(var d=0;d<a.length;d++)Promise.resolve(a[d]).then(b,c)})},Promise}(),window.define&&define.amd&&define(function(){return Promise});
